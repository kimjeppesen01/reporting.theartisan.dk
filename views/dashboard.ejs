<%- include('layout', { pageTitle: 'Dashboard â€” Business Review' }) %>

<% if (error) { %>
  <div class="error-banner"><%= error %></div>
<% } %>

<!-- Top bar: tabs + period selector -->
<div class="topbar">
  <div class="business-tabs">
    <a href="/dashboard?tab=cafe&period=<%= period %>&offset=<%= offset %>" class="btab <%= tab === 'cafe' ? 'active' : '' %>">
      â˜• CafÃ©
      <% if (tab === 'cafe' && activeRevenue > 0) { %>
        <span class="margin-pill <%= grossProfit >= 0 ? 'positive' : 'negative' %>"><%= formatPercent(profitMargin) %></span>
      <% } %>
    </a>
    <a href="/dashboard?tab=events&period=<%= period %>&offset=<%= offset %>" class="btab <%= tab === 'events' ? 'active' : '' %>">
      ğŸª Events
    </a>
    <a href="/dashboard?tab=b2b&period=<%= period %>&offset=<%= offset %>" class="btab <%= tab === 'b2b' ? 'active' : '' %>">
      ğŸ¤ B2B
    </a>
    <a href="/dashboard?tab=webshop&period=<%= period %>&offset=<%= offset %>" class="btab <%= tab === 'webshop' ? 'active' : '' %>">
      ğŸ›’ Webshop
      <% if (tab === 'webshop' && activeRevenue > 0) { %>
        <span class="margin-pill <%= grossProfit >= 0 ? 'positive' : 'negative' %>"><%= formatPercent(profitMargin) %></span>
      <% } %>
    </a>
  </div>
  <div class="period-tabs">
    <a href="/dashboard?tab=<%= tab %>&period=weekly&offset=<%= offset %>" class="tab <%= period === 'weekly' ? 'active' : '' %>">Weekly</a>
    <a href="/dashboard?tab=<%= tab %>&period=monthly&offset=<%= offset %>" class="tab <%= period === 'monthly' ? 'active' : '' %>">Monthly</a>
    <a href="/dashboard?tab=<%= tab %>&period=yearly&offset=<%= offset %>" class="tab <%= period === 'yearly' ? 'active' : '' %>">Yearly</a>
  </div>
</div>

<div class="period-nav">
  <a href="/dashboard?tab=<%= tab %>&period=<%= period %>&offset=<%= offset - 1 %>" class="period-nav-btn" title="Previous period">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
  </a>
  <span class="period-nav-label"><%= periodLabel %> <span class="period-nav-range">&middot; <%= dateRange %></span></span>
  <% if (offset < 0) { %>
    <a href="/dashboard?tab=<%= tab %>&period=<%= period %>&offset=<%= offset + 1 %>" class="period-nav-btn" title="Next period">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
    </a>
  <% } else { %>
    <span class="period-nav-btn period-nav-btn-disabled">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
    </span>
  <% } %>
</div>

<!-- Main layout: left panel + right sidebar -->
<div class="main-layout">

  <!-- LEFT: P&L panel -->
  <div class="pl-panel">
    <%- include('partials/pl-report') %>
  </div>

  <!-- RIGHT: Uncategorized sidebar -->
  <div class="sidebar">
    <%- include('partials/uncategorized') %>
  </div>

</div>

<!-- Cashflow Command Center (full-width, below main layout) -->
<%- include('partials/cashflow-command') %>

<!-- Pass waterfall data to JS -->
<script id="waterfall-data" type="application/json"><%- JSON.stringify(waterfallData) %></script>
<script id="all-categories" type="application/json"><%- JSON.stringify(allCategories) %></script>

<%- include('footer') %>
